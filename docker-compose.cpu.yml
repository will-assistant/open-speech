###############################################################################
# Open Speech â€” CPU only
#
# Usage:
#   docker compose -f docker-compose.cpu.yml up -d
#
# No GPU required. Uses int8 quantization and tiny model for speed.
# Good for testing, development, or low-resource hosts.
#
# Web UI:  https://localhost:8100/web
# API:     https://localhost:8100/v1/audio/transcriptions
# Docs:    https://localhost:8100/docs
###############################################################################

services:
  open-speech:
    build:
      context: .
      dockerfile: Dockerfile.cpu
    image: jwindsor1/open-speech:cpu
    container_name: open-speech
    restart: unless-stopped
    ports:
      - "8100:8100"
    environment:
      - STT_DEVICE=cpu
      - STT_COMPUTE_TYPE=int8
      - STT_DEFAULT_MODEL=Systran/faster-whisper-base
      - STT_PRELOAD_MODELS=Systran/faster-whisper-tiny,Systran/faster-whisper-base,Systran/faster-whisper-small
      - STT_PORT=8100
      - STT_HOST=0.0.0.0
      # Streaming config
      - STT_STREAM_CHUNK_MS=2000
      - STT_STREAM_VAD_THRESHOLD=0.5
      - STT_STREAM_ENDPOINTING_MS=300
      - STT_STREAM_MAX_CONNECTIONS=10
    volumes:
      - hf-cache:/root/.cache/huggingface
      - vad-cache:/root/.cache/silero-vad

volumes:
  hf-cache:
  vad-cache:
